import stringSimilarity from "string-similarity";
import { cleanName } from "../utils/clean-name.js";

const brazilianNovelaKeywords = [
    "Bang Bang",
    "Dona de Mim",
    "O Outro",
    "Eta Mundo Melhor",
    "Vale Tudo",
    "As Filhas da Senhora Garcia",
    "O Amor Invencivel",
    "Perola Negra",
    "Senhora do Mar",
    "Alem do Tempo",
    "Amor sem Igual",
    "A Gata",
    "O Outro Lado do Paraíso",
    "A Caverna Encantada",
    "Teresa",
    "Cafe com Aroma de Mulher",
    "Rosalinda",
    "Amores Verdadeiros",
    "Forca de um Desejo",
    "Ribeirao do Tempo",
    "Fragmentos Uma Rosa Com Amor",
    "Mania de Voce",
    "Sete Pecados",
    "Plumas e Paetes",
    "Rebelde Brasileiro",
    "Chamas da Vida",
    "Coracoes Feridos",
    "Amor Real",
    "Tres vezes Ana",
    "Cara e Coroa",
    "A Moreninha",
    "Zorro: A Espada e a Rosa",
    "Volta por Cima",
    "Historia de Amor",
    "A Forca do Querer",
    "Malhacao 2010",
    "Viver a Vida",
    "I Love Paraisopolis",
    "Irmaos Coragem",
    "Gotinha de Amor",
    "Sai de Baixo",
    "Que Rei Sou Eu?",
    "Pecado Rasgado",
    "Da Cor do Pecado",
    "Mandacaru",
    "Terra e Paixao",
    "Deus Nos Acuda",
    "Locomotivas",
    "A Muralha",
    "Chocolate com Pimenta",
    "Corpo a Corpo",
    "Canavial de Paixões",
    "Malhacao Sonhos",
    "Promessas de Amor",
    "Xica da Silva",
    "Amor e Intrigas",
    "Carrossel",
    "Viva as Crianças Carrossel 2",
    "Quanto Mais Vida Melhor",
    "Meu Coracao e Teu",
    "Ferias em Familia",
    "Isa TKM",
    "Lacos de Familia",
    "As Aventuras de Poliana",
    "Maria Esperanca",
    "Prova de Amor",
    "No Rancho Fundo",
    "Poder Paralelo",
    "O Rebu",
    "Aquele Beijo",
    "Os Mutantes Caminhos do Coracao",
    "Top Model",
    "Inimigo intimo",
    "Rubi",
    "Familia e Tudo",
    "Renascer",
    "Alma Gemea",
    "Anjo Mau",
    "Os Dez Mandamentos - Nova Temporada",
    "Renascer",
    "Amor Eterno Amor",
    "Malhacao 2000",
    "Malhacao 2002",
    "Malhacao 1995",
    "Malhacao 2010",
    "Esmeralda",
    "Chiquititas",
    "Pantanal",
    "Genesis",
    "Cumplices de um Resgate",
    "Salve Jorge",
    "Fera Ferida",
    "Vale Tudo",
    "Tres Irmas",
    "A Dona",
    "Verdades Secretas",
    "Ti Ti Ti",
    "Duas Caras",
    "Vidas Opostas",
    "Mulheres de Areia",
    "Porto dos Milagres",
    "Marisol",
    "Felicidade",
    "O Cravo e a Rosa",
    "A Terra Prometida",
    "Passione",
    "Roque Santeiro",
    "O Que a Vida Me Roubou",
    "Esperanca",
    "Andando nas Nuvens",
    "Pai Heroi",
    "Estrela Guia",
    "Amanha E Para Sempre",
    "Tempos Modernos",
    "Paraiso",
    "Vira Lata",
    "Quando Me Apaixono",
    "Uma Rosa com Amor",
    "Desejos de Mulher",
    "Paraiso",
    "Elas por Elas",
    "Gata Selvagem",
    "Sandy & Junior",
    "Fascinacao",
    "Deus Salve o Rei",
    "Bicho do Mato",
    "Suave Veneno",
    "Armacao Ilimitada",
    "Tempo de Amar",
    "Belissima",
    "A Que Nao Podia Amar",
    "A Desalmada",
    "RBD A Família",
    "Morde e Assopra",
    "Cumplices de um Resgate",
    "Corpo Dourado",
    "Essas Mulheres",
    "Rebelde",
    "O Dono do Mundo",
    "A Lua Me Disse",
    "Novo Mundo",
    "Terra Nostra",
    "Beleza Pura",
    "Riacho Doce",
    "As Tres Irmas",
    "Poliana Moca",
    "A Usurpadora",
    "A Viagem",
    "Caminho das Indias",
    "Fina Estampa",
    "Jezabel",
    "Marimar",
    "O Clone",
    "O Profeta",
    "O Rei do Gado",
    "O Sétimo Guardião",
    "Senhora do Destino",
    "O Quinto dos Infernos",
    "A Próxima Vítima",
    "America",
    "Araguaia",
    "Agora é Que São Elas",
    "Amor a Vida",
    "Coracao de Estudante",
    "Escrito nas Estrelas",
    "Eta Mundo Bom",
    "O Rico e Lazaro",
    "Sinha Moca",
    "Torre de Babel",
    "Por Amor",
    "Anjo Mau",
    "Bom Sucesso",
    "Cheias de Charme",
    "Malhacao 2008",
    "Topíssima",
    "Flor do Caribe",
    "Pega Pega",
    "Sangue Bom",
    "Velho Chico",
    "Boogie Oogie",
    "Xilindró",
    "Brega & Chique",
    "Os Dias Eram Assim",
    "O Dono do Lar",
    "Salve se Quem Puder",
    "A Regra do Jogo",
    "Manancial",
    "A Madrasta",
    "Rock Story",
    "Haja Coração",
    "Paginas da Vida",
    "Maysa: Quando Fala o Coração",
    "Além da Ilusão",
    "Travessia",
    "Sassaricando",
    "Saramandaia",
    "Rainha da Sucata",
    "Mar do Sertao",
    "Todas as Flores",
    "Tieta",
    "Cordel Encantado",
    "O Beijo do Vampiro",
    "Cama de Gato",
    "Avenida Brasil",
    "A Vida da Gente",
    "Coracao Marcado",
    "O Salvador da Pátria",
    "Caras e Bocas",
    "Malhacao Casa Cheia",
    "Malhacao Intensa Como a Vida",
    "Malhacao Seu Lugar no Mundo",
    "Dona Beija",
    "Barriga de Aluguel",
    "Um Lugar ao Sol",
    "Sonho Meu",
    "Amor com Amor Se Paga",
    "Pe na Jaca",
    "Os Mutantes",
    "A Escrava Isaura",
    "Segundo Sol",
    "Sortilegio",
    "Babilonia",
    "Vereda Tropical",
    "Mulheres Apaixonadas",
    "Cabocla",
    "A Historia de Ester",
    "Lia",
    "Vai na Fe",
    "A Indomada",
    "A Historia de Ana Raio e Ze Trovao",
    "Caca Talentos",
    "A Intrusa",
    "Roda de Fogo",
    "Explode Coracao",
    "Nos Tempos do Imperador",
    "Pedra Sobre Pedra",
    "Selva de Pedra",
    "Fera Radical",
    "Mascaras",
    "O Astro",
    "Lado a Lado",
    "Meu Bem Meu Mal",
    "A Cor da Paixao",
    "Pele Selvagem",
    "Amigas e Rivais",
    "A Feia Mais Bela",
    "Abraca me Muito Forte",
    "Rubi",
    "Orgulho e Paixao",
    "O Privilegio de Amar",
    "Mad Maria",
    "Joia Rara",
    "Guerra dos Sexos",
    "Escrava Mae",
    "Coracao Indomavel",
    "Cobras e Lagartos",
    "A Gata Comeu",
    "Fuzue",
    "Verdades Secretas 2",
    "Despedida de Solteiro",
    "Amor Perfeito",
    "Em Família"
];

export function isBrazilianNovela(stream) {
  let score = 0;

  if (stream?.tmdb?.genre_ids?.includes(10766)) {
    score += 3;
  }

  if (stream?.tmdb?.origin_country?.some(c => c === "BR")) {
    score += 2;
  }

  if (stream?.tmdb?.networks?.some(c => c.name.includes('Record'))) {
    score += 3;
  }

  if (stream?.tmdb?.networks?.some(c => c.name.includes('TV Globo'))) {
    score += 3;
  }

  const title = cleanName(stream?.title?.toLowerCase()) ?? cleanName(stream?.stream_display_name?.toLowerCase());
  const match = stringSimilarity.findBestMatch(title, brazilianNovelaKeywords.map(n => n.toLowerCase()));
  if (match.bestMatch.rating > 0.4) {
    score += 1;
  }

  if (stream?.category_names?.toLowerCase()?.includes('novela') && !stream?.category_names?.toLowerCase()?.includes('turca')) {
    return true;
  }

  // só retorna true se categoria + país ou categoria + nome
  return score >= 3;
}
